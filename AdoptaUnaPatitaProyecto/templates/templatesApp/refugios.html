{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Refugios</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body class="bodygeneral">

<h2>Refugios</h2>

<!-- Botón para agregar un nuevo refugio -->
{% if rol == "admin" %}
<a href="{% url 'crear_refugio' %}?rol={{ rol }}">
    <button class="btn-accion">Agregar Refugio</button>
</a>
{% endif %}

<br><br>

<!-- Tabla de refugios -->
<table class="tabla-general">
    <thead>
        <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Dirección</th>
            <th>Teléfono</th>
            {% if rol == "admin" %}<th>Acciones</th>{% endif %}
        </tr>
    </thead>
    <tbody>
        {% for refugio in refugios %}
        <tr data-id="{{ refugio.id }}">
            <td>{{ refugio.id }}</td>
            <td class="nombre">{{ refugio.nombre }}</td>
            <td class="direccion">{{ refugio.direccion }}</td>
            <td class="telefono">{{ refugio.telefono }}</td>
            {% if rol == "admin" %}
            <td>
                <a href="#" onclick="eliminar_refugio({{ refugio.id }})" style="color:#ff0000; font-weight:bold;">Eliminar</a> |
                <a href="{% url 'actualizar_refugio' refugio.id %}?rol={{ rol }}" style="color:#00b7ff; font-weight:bold;">Editar</a>
            </td>
            {% endif %}
        </tr>
        {% empty %}
        <tr>
            <td colspan="5">No hay refugios registrados.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<br>

<!-- Botón para volver al menú -->
<a href="{% url 'menu' %}?rol={{ rol }}">
    <button class="btn-accion">Volver al Menú</button>
</a>

<script>
const csrftoken = '{{ csrf_token }}';

// Función eliminar
function eliminar_refugio(id){
    if(!confirm('¿Seguro quieres eliminar este refugio?')) return;

    fetch(`/refugios/eliminar/${id}/`, {
        method: 'DELETE',
        headers: {'X-CSRFToken': csrftoken}
    })
    .then(res => res.json())
    .then(data => {
        if(data.mensaje){
            alert(data.mensaje);
            document.querySelector(`tr[data-id="${id}"]`).remove();
        } else alert(data.error);
    })
    .catch(err => alert('Error: ' + err));
}
</script>
</body>
</html>

